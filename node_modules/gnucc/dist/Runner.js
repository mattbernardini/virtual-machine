"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const child_process_1 = require("child_process");
const Logger_1 = require("./Logger");
;
function Run(args, log, env) {
    let command = args.join(' ');
    log && Logger_1.LogOutput(command);
    const proc = child_process_1.spawn(args.shift() || 'echo', args);
    let stdout = [], stderr = [];
    proc.stdout.on('data', data => {
        data = data.toString(); // safety
        stdout.push(data);
        log && Logger_1.LogOutput(data);
    });
    proc.stderr.on('data', data => {
        data = data.toString(); // safety
        stderr.push(data);
        log && Logger_1.LogError(data);
    });
    return new Promise((resolve, reject) => {
        proc.on('close', exitCode => {
            log && Logger_1.LogExit(exitCode);
            resolve({
                command,
                stdout: stdout.join('\n'),
                stderr: stderr.join('\n'),
                exitCode
            });
        });
    });
}
exports.default = Run;
;
